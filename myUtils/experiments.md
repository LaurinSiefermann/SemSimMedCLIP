# Thanks for running the experiments Marco.

In the following you find the arguments for our experiments.

# ToDos for you:
1) Pull git repo (https://github.com/LaurinSiefermann/open_clip_based_thesis/tree/my_branch)
2) Install conda env (open_clip_based_thesis/environment.yml)
3) Commect to wandB (get your API key here: https://wandb.ai/settings)
4) Search and replace "/home/lsiefermann/open_clip_based_thesis/myUtils/" with your path to pkl datasets.
5) Search and replace /scratch1/MIMIC/physionet.org/files/mimic-cxr-jpg-resized/2.0.0/ with "/scratch/datasets/medical/MIMIC/"
6) Search and replace "/scratch1/lsiefermann/logs/" with where you want to save the logs
7) Replace gpu number before running an experiment

# 1  Report level - ChexPert 
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#1-Report-level-ChexPert] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --loss-type single_feature --similarity-decision-1 chexPert-labels --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model 

# 2  Report level - Chexpert / Sentence level - Chexpert
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#2-Report-level-Chexpert___Sentence-level-Chexpert] -- gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 15 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --loss-type multiple_features --similarity-decision-1 chexPert-labels --similarity-decision-2 chexPert-labels --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model 

# 3  Report level - Chexpert / Sentence level - sBERT
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#3-Report-level-Chexpert___Sentence-level-sBERT] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 15 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type multiple_features --similarity-decision-1 chexPert-labels --similarity-decision-2 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model

# 4.1  Report level - sBERT 
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-sBERT] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --threshold=0.7799323466234653

# 4.1  Report level - sBERT - top-k3
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-sBERT-topk3] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --top-k 3 --threshold=0.7799323466234653

# 4.1  Report level - sBERT - top-k5
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-sBERT-topk5] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --top-k 5 --threshold=0.7799323466234653

# 4.1  Report level - sBERT - top-k7
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-sBERT-topk7] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --top-k 7 --threshold=0.7799323466234653

# 4.1  Report level - sBERT - top-k10
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-sBERT-topk10] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --top-k 10 --threshold=0.7799323466234653

# 4.2  Report level - BioSimCSE-BioLinkBERT-BASE
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-BioSimCSE-BioLinkBERT-BASE] --gpu 7 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 35 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model kamalkraj/BioSimCSE-BioLinkBERT-BASE --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.6444593141522845

# 4.2  Report level - Bilingual-BioSimCSE-BioLinkBERT-base
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#4-Report-level-Bilingual-BioSimCSE-BioLinkBERT-base] --gpu 7 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 35 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model kaiserrr/Bilingual-BioSimCSE-BioLinkBERT-base --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.7534596715972709

# 5  Report level - sBERT / Sentence level - Chexpert
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#5-Report-level-sBERT___Sentence-level-Chexpert] -- gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 15 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type multiple_features --similarity-decision-1 text_similarity_model --similarity-decision-2 chexPert-labels --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model

# 6  Report level - sBERT / Sentence level - sBERT
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#6-Report-level-sBERT___Sentence-level-sBERT] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 15 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type multiple_features --similarity-decision-1 text_similarity_model --similarity-decision-2 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model

# 7  Sentence level - ChexPert 
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#7-Sentence-level-ChexPert] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic_sentence_image.pkl --val-data /scratch/mcipriano/laurin/val_mimic_sentence_image.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4--warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --loss-type single_feature --similarity-decision-1 chexPert-labels --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model

# 8  Sentence level - sBERT
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#8-Sentence-level-sBERT] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic_sentence_image.pkl --val-data /scratch/mcipriano/laurin/val_mimic_sentence_image.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key sentences --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.8741

## new
# 8.2  Sentence level - BioSimCSE-BioLinkBERT-BASE
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#8-Sentence-level-BioSimCSE-BioLinkBERT-BASE] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic_sentence_image.pkl --val-data /scratch/mcipriano/laurin/val_mimic_sentence_image.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key sentences --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model kamalkraj/BioSimCSE-BioLinkBERT-BASE --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.8741

# 8.3  Sentence level - Bilingual-BioSimCSE-BioLinkBERT-base
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#8-Sentence-level-Bilingual-BioSimCSE-BioLinkBERT-base] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic_sentence_image.pkl --val-data /scratch/mcipriano/laurin/val_mimic_sentence_image.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key sentences --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image --text-similarity-model kaiserrr/Bilingual-BioSimCSE-BioLinkBERT-base --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.8741

# 9 Report level - CLIP LOSS 
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#9-Report-level-CLIP-LOSS] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model bioClinicalBERT-timm-swin_small_patch4_window7_224 --pretrained-image  --loss-type clip --similarity-decision-1 None --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model 


## Further models for Baseline (all of them take 30 sec to run)
# 10 Random-RN50 - Report level 
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#10-Report-level-Random-RN50] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model RN50 --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --threshold=0.7799323466234653

# 11 Pretrained Imagenet - Report level 
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#11-Report-level-Imagenet] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic.pkl --val-data /scratch/mcipriano/laurin/val_mimic.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key REPORT --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100 --lr 5e-5 --wd 1e-4 --warmup 2500 --model resnet50.a1_in1k --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb  --save-only-best-model --threshold=0.7799323466234653

# 12 Random-RN50 - sentence level
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#12-Sentence-level-Random-RN50] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic_sentence_image.pkl --val-data /scratch/mcipriano/laurin/val_mimic_sentence_image.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key sentences --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model RN50 --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.8741

# 13 Pretrained Imagenet - sentence level
/home/mcipriano/projects/laurin/src/training/main.py --exp-desc [#13-Sentence-level-Imagenet] --gpu 0 --train-data /scratch/mcipriano/laurin/train_mimic_sentence_image.pkl --val-data /scratch/mcipriano/laurin/val_mimic_sentence_image.pkl --mimimc-5x200 /scratch/mcipriano/laurin/eval_mimic_5x200.pkl --chexpert-5x200 /scratch/mcipriano/laurin/eval_chexpert_5x200.pkl --dataset-type pkl --pkl-img-key jpg_paths --pkl-text-key sentences --img-base-path /scratch/datasets/medical/MIMIC/ --workers 4 --epochs 25 --batch-size 100  --lr 5e-5 --wd 1e-4 --warmup 2500 --model resnet50.a1_in1k --pretrained-image --text-similarity-model all-distilroberta-v1 --loss-type single_feature --similarity-decision-1 text_similarity_model --zeroshot-frequency 1 --logs /scratch/mcipriano/results/laurin/ --report-to wandb --save-only-best-model --threshold=0.8741